# Topics

이전 튜토리얼에서는 로깅 시스템을 개선했습니다. Dummy Broadcast만 수용했던 fanout exchange를 대신해 direct exchange를 사용하여 로그를 선택적으로 수신할 수 있었습니다.

direct exchange를 사용하면 시스템이 개선되겠지만, 아직도 여러 기준에 따라 라우팅을 할 수 없는 제한이 있습니다.

로깅 시스템은 심각도뿐만 아니라 로그를 내보낸 소스에 따라 로그를 구독해야 할 수도 있어야 합니다. 이 개념은 심각도(info/warn/vit...)와 기능(auth/cron/kern...)을 기준으로 로그를 라우팅하는 syslog Unix 도구를 통해 알 수 있습니다.

이는 유연성이 크게 향상시킵니다. 'cron'에서 발생하는 치명적인 오류뿐 아니라 'kern'에서 발생하는 모든 로그도 들을 수 있습니다.

로깅 시스템에서 이를 구현하기 위해서는 좀 더 복잡한 topic exchange에 대해 알아야 합니다.

Topic exchange

`topic` exchange로 전송된 메시지는 임의 라우팅키를 가질 수 없습니다. 이 메시지는 점( . )으로 구분된 단어 목록이어야 합니다. 단어는 무엇이든 될 수 있지만 일반적으로 메시지의 기능 일부를 지칭합니다. 몇 가지 올바른 라우팅 주요 예로는 "`stock.usd.nyse`", "`nyse.vmw`", "`quick.orange.rabbit`"이 있습니다. 라우팅키에는 255바이트까지 원하는 만큼의 단어를 사용할 수 있습니다.

바인딩키도 동일한 형식이어야 합니다. `topic` exchange의 작동원리는 `direct` exchange와 유사합니다. 특정 라우팅키와 함께 전송되는 메시지는 일치하는 바인딩키로 바인딩된 모든 대기열에 전달됩니다. 그러나 `topic` exchange의 바인딩키에는 `direct` exchange와 다른 두 가지 중요한 차이점 있습니다.

+ `*` (star) 대체될 단어가 정확히 하나일 경우 사용할 수 있습니다.
+ `#` (hash) 대체될 단어가 없거나 하나 이상일 경우 사용할 수 있습니다.

쉬운 방법으로 설명하겠습니다.

이 예제에서 동물을 묘사하는 메시지를 보낼 것입니다. 메시지는 두 개의 점으로 구분된 세 개의 단어로 구성된 라우팅키와 함께 전송됩니다. 라우팅키의 첫 번째 단어는 동물의 속도를 나타내며, 두 번째 단어는 동물의 색, 세 번째 단어는 동물의 종을 나타냅니다. 이제 라우팅키는 "`<속도>.<색>.<종>`"의 조합으로 구성될 것입니다.

세 가지 바인딩을 만들었습니다. Q1은 바인딩 키 "`*.orange.*`"로 바인딩됩니다. Q2는 "`*.*.rabbit`"과 "`lazy.#`"로 바인딩됩니다.